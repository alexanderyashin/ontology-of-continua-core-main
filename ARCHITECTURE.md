# Repository Architecture — Ontology of Continua Core 1.1

This document defines the canonical architecture of the repository.
It serves as the stable reference for all future Core releases and domain-specific preprints.

The structure described here is authoritative.
All updates to the repository must also update this file.

------------------------------------------------------------
1. High-Level Repository Structure
------------------------------------------------------------

/
  main.tex
  preamble.tex
  build_core.sh
  README.md
  ARCHITECTURE.md
  CONVENTIONS.md
  BUILD_NOTES.md
  LICENSE
  .gitignore
  .zenodo.json

  master_core_structure.yaml

  content/
    frontmatter.tex
    _auto_core_inputs.tex        (generated automatically; do NOT edit)

    01_intro.tex
    02_background.tex
    03_model.tex
    04_results.tex
    05_discussion.tex
    06_conclusion.tex
    07_figures.tex

    placeholders/
      fig_placeholder.pdf
      table_placeholder.tex
      section_template.tex

  figures/
    (all real figures go here)

  bib/
    references.bib

  tools/
    generate_core_from_yaml.py
    validate_core_structure.py
    generate_auto_inputs.py

  build/
    (generated automatically)
    logs/
      compile.log

  .github/
    workflows/
      build-core.yml

------------------------------------------------------------
2. Core Build Logic
------------------------------------------------------------

Core 1.1 uses a strict, reproducible, YAML-driven build architecture.

The ONLY valid build entry point is:

    ./build_core.sh

This script performs four steps:

1. Generate missing .tex files from master_core_structure.yaml  
   (tools/generate_core_from_yaml.py)

2. Validate repository structure  
   (tools/validate_core_structure.py)

3. Generate content/_auto_core_inputs.tex  
   (tools/generate_auto_inputs.py)

4. Compile main.tex via latexmk using XeLaTeX  
   Output: build/main.pdf

Users MUST NOT run latexmk directly, except for debugging.

------------------------------------------------------------
3. Main LaTeX Files
------------------------------------------------------------

### main.tex
The single entry point that constructs the entire Core 1.1 document.
The order is frozen:

  \input{preamble}
  \input{content/frontmatter.tex}
  \input{content/_auto_core_inputs.tex}
  \input{content/07_figures.tex}
  \printbibliography

Direct modification requires approval from OK Main HQ + TOC HQ.

### preamble.tex
Global configuration layer:
- XeLaTeX engine
- fontspec (DejaVu fonts)
- polyglossia
- amsmath / amsthm / mathtools
- graphicx
- hyperref
- cleveref
- csquotes
- biblatex

This file is part of the frozen architecture and must remain stable.

------------------------------------------------------------
4. YAML Structure and Auto-Generated Inputs
------------------------------------------------------------

### master_core_structure.yaml  
Defines the ordered list of Core sections (except frontmatter and figures).

### content/_auto_core_inputs.tex  
Generated automatically from YAML.
Contains ordered \input{…} statements for all Core sections.

Rules:

- DO NOT edit this file manually.
- DO NOT commit edits to this file.
- It is always regenerated by ./build_core.sh.

------------------------------------------------------------
5. Content Directory (content/)
------------------------------------------------------------

Contains all scientific content:

- frontmatter.tex
- numbered section files (NN_name.tex)
- automatically generated _auto_core_inputs.tex
- 07_figures.tex (static part of document)
- placeholders for early drafts

Only numbered sections should contain scientific text.

No figures, images, binaries, or external files are allowed here.

------------------------------------------------------------
6. Figures (figures/)
------------------------------------------------------------

All figures must be stored here.

Allowed formats:
- pdf (preferred)
- png
- jpg

No figures should be inside content/ except placeholders/.

------------------------------------------------------------
7. Bibliography (bib/)
------------------------------------------------------------

references.bib is the single bibliography database.

Controlled by:
- biblatex
- biber

Biber is invoked automatically by latexmk via build_core.sh.

------------------------------------------------------------
8. Tools (tools/)
------------------------------------------------------------

### generate_core_from_yaml.py
Creates missing .tex files based on master_core_structure.yaml.

### validate_core_structure.py
Validates:
- YAML correctness
- section presence
- missing files
- consistency

Does NOT stop build by default.

### generate_auto_inputs.py
Creates content/_auto_core_inputs.tex.

This file must never be edited manually.

------------------------------------------------------------
9. Build Directory (build/)
------------------------------------------------------------

Generated automatically by latexmk.

Contains:
- main.pdf
- main.log
- main.aux
- main.toc
- main.bbl
- main.xdv
- logs/compile.log

The entire build/ directory is ignored by Git.

------------------------------------------------------------
10. GitHub Actions (CI Pipeline)
------------------------------------------------------------

File:

  .github/workflows/build-core.yml

Workflow steps:

1. Checkout repository
2. Install TeX Live + latexmk
3. chmod +x build_core.sh
4. Run ./build_core.sh
5. Upload build/main.pdf as artifact

This ensures reproducible builds for every commit to main.

No CI step may call latexmk or generators directly.

------------------------------------------------------------
11. Metadata (.zenodo.json)
------------------------------------------------------------

Defines:
- title, version
- creators + ORCID
- license (CC-BY-4.0)
- description
- DOI integration

Zenodo snapshots GitHub releases automatically.

------------------------------------------------------------
12. Repository Conventions (short reference)
------------------------------------------------------------

- All section files live in content/.
- Filenames follow NN_name.tex.
- Figures go only into figures/.
- build/ is not tracked.
- master_core_structure.yaml defines section order.
- auto-generated files must not be edited.
- main.tex and preamble.tex are frozen.

------------------------------------------------------------
13. Purpose
------------------------------------------------------------

This architecture guarantees:

- structural stability
- reproducibility
- CI determinism
- clean separation of content and tooling
- seamless Zenodo archiving
- long-term maintainability

This architecture is the foundation for all future versions of the Ontology of Continua Core.
